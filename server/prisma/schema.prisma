// Prisma schema for Directorio de Pod√≥logos
// Database: PostgreSQL with PostGIS and pg_trgm extensions

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// Users table (patients and admin users)
model User {
  id        String   @id @default(uuid())
  email     String   @unique
  password  String
  name      String
  phone     String?
  role      Role     @default(USER)
  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  reviews Review[]

  @@map("users")
}

enum Role {
  USER
  PROFESSIONAL
  ADMIN
}

// Professionals table (podiatrists)
model Professional {
  id            String   @id @default(uuid())
  name          String
  slug          String   @unique
  bio           String?
  clinicAddress String?  @map("clinic_address")
  city          String?
  postalCode    String?  @map("postal_code")
  phone         String?
  email         String?
  licenseNumber String?  @map("license_number")
  verified      Boolean  @default(false)
  latitude      Float?
  longitude     Float?
  rating        Float?   @default(0)
  reviewCount   Int      @default(0) @map("review_count")
  createdAt     DateTime @default(now()) @map("created_at")
  updatedAt     DateTime @updatedAt @map("updated_at")

  services Service[]
  reviews  Review[]
  leads    Lead[]

  @@index([city])
  @@index([slug])
  @@index([verified])
  @@map("professionals")
}

// Services offered by professionals
model Service {
  id              String       @id @default(uuid())
  professional    Professional @relation(fields: [professionalId], references: [id], onDelete: Cascade)
  professionalId  String       @map("professional_id")
  title           String
  description     String?
  price           Float?
  durationMinutes Int?         @map("duration_minutes")
  createdAt       DateTime     @default(now()) @map("created_at")
  updatedAt       DateTime     @updatedAt @map("updated_at")

  @@index([professionalId])
  @@map("services")
}

// Reviews for professionals
model Review {
  id             String       @id @default(uuid())
  professional   Professional @relation(fields: [professionalId], references: [id], onDelete: Cascade)
  professionalId String       @map("professional_id")
  user           User?        @relation(fields: [userId], references: [id], onDelete: SetNull)
  userId         String?      @map("user_id")
  rating         Int
  comment        String?
  createdAt      DateTime     @default(now()) @map("created_at")
  updatedAt      DateTime     @updatedAt @map("updated_at")

  @@index([professionalId])
  @@index([userId])
  @@map("reviews")
}

// Leads (contact requests)
model Lead {
  id             String        @id @default(uuid())
  professional   Professional? @relation(fields: [professionalId], references: [id], onDelete: SetNull)
  professionalId String?       @map("professional_id")
  userName       String        @map("user_name")
  userEmail      String?       @map("user_email")
  userPhone      String?       @map("user_phone")
  message        String
  status         LeadStatus    @default(NEW)
  createdAt      DateTime      @default(now()) @map("created_at")
  updatedAt      DateTime      @updatedAt @map("updated_at")

  @@index([professionalId])
  @@index([status])
  @@map("leads")
}

enum LeadStatus {
  NEW
  CONTACTED
  CONVERTED
  CLOSED
}
